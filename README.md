# BackToZaraysk

Проект на Unreal Engine 5.3+ с системой инвентаря, экипировки и взаимодействия с предметами.

## Основные возможности

- **Система инвентаря**: Полнофункциональный инвентарь с drag-and-drop, ротацией предметов (R), контекстными меню
- **Экипировка**: Автоматическая экипировка предметов (рюкзаки, жилеты) при подборе
- **Хранилища**: Рюкзак с сеткой, жилет с дополнительным хранилищем, пояс, 4 кармана 1x1
- **Предметы**: Кубы 1x1 и 2x2, рюкзаки, тактические жилеты с визуальным отображением на персонаже
- **Персистентность**: Сохранение содержимого рюкзаков при выбросе/подборе
- **UI**: Адаптивный интерфейс инвентаря с поддержкой клавиатуры и мыши

## Система управления

- **I** - Открыть/закрыть инвентарь
- **E** - Взаимодействие с предметами
- **G** - Выбросить последний предмет из рюкзака
- **R** - Повернуть предмет (при наведении курсора или перетаскивании)
- **ПКМ** - Контекстное меню предмета (Надеть/Снять/Выбросить)
- **Перетаскивание** - Перемещение предметов между слотами и хранилищами

## Правила Drag&Drop (актуально)

- **Проверка размера по ячейкам**: предмет можно положить в клетку только если справа и снизу достаточно свободных клеток под весь размер предмета.
- **Автоповорот**: если предмет 1x2 не влезает в 1x1/2x1, автоматически пробуется поворот (1x2 ↔ 2x1). Если и после поворота не влезает — дроп отменяется.
- **Карманы**: принимают только 1x1 (1x2/2x1 допускаются только при автоповороте до 1x1).
- **Жилет**: проверяется попадание в конкретный мини‑грид жилета; автоповорот включён, если текущая ориентация не помещается.
- **Рюкзак**: дроп возможен только если область свободна (без пересечений с другими предметами).

## Экипировка и выброс

- **Жилет — Снять**: если рюкзак надет — жилет уходит в инвентарь; если рюкзака нет — жилет выбрасывается в мир (спавн pickup).
- **Рюкзак — Выбросить**: спавнится ровно один pickup рюкзака, содержимое и позиции предметов сохраняются в данных рюкзака.
- **Кнопка «Снять» активна** только если предмет действительно находится в своём слоте экипировки.

## Хранилище жилета (актуально)

- **6 мини‑секций** жилета: предметы раскладываются по секциям; при дропе запоминается секция.
- **Сохранение раскладки**: при закрытии/открытии инвентаря и при выбросе/подборе жилета восстанавливаются содержимое и секции предметов.
- **Анти‑дубликаты**: перед перерисовкой гридов жилета полностью очищаются старые виджеты и маппинги.

## Изменения (кратко)

- Единый стиль гридов (пояс/карманы/рюкзак/жилет).
- Починен DnD между всеми зонами; убраны наложения и дубли.
- Сохранение позиций предметов в рюкзаке; корректный выброс/подбор без потерь.
- Жилет корректно отображается в слоте; «Снять» работает по правилам выше.

## Сборка и запуск

### Требования
- Unreal Engine 5.3+
- Visual Studio 2022 (C++ Desktop, Windows SDK)
- Git LFS

### Установка
Рекомендуемый порядок — **сначала поставить LFS**, затем клонировать репозиторий.

```bash
git lfs install
git clone https://github.com/SURPAT-Enjoyer/BackToZaraysk.git
cd BackToZaraysk
```

Дальше:
- Откройте `BackToZaraysk.uproject` (двойной клик) и при запросе согласитесь на сборку модулей.
- Если нужно — сгенерируйте файлы проекта VS: ПКМ по `.uproject` → **Generate Visual Studio project files**.

### Сборка
```powershell
.\build_ue53.bat
```

## Архитектура проекта

### Основные компоненты
- `UInventoryComponent` - Управление инвентарем и экипировкой
- `UInventoryWidget` - UI инвентаря с drag-and-drop
- `UEquipmentComponent` - Визуальное отображение экипированных предметов
- `APickupBase` и наследники - Предметы в мире для подбора

### Система предметов
- `UInventoryItemData` - Базовые данные предмета
- `UEquippableItemData` - Данные экипируемых предметов с хранилищами
- `APickupCube`, `APickupBackpack`, `ATacticalVest` - Pickup-акторы

## Git LFS

Проект использует Git LFS для бинарных файлов:
- `.uasset`, `.umap`, `.ubulk`, `.uexp` - Ассеты UE5
- `.fbx` - 3D модели
- `.png`, `.jpg`, `.tga`, `.bmp` - Текстуры
- `.wav`, `.ogg`, `.mp3` - Аудио

Если после клона ассеты “пустые” или видите LFS pointer-файлы — выполните:

```bash
git lfs pull
```

## Что исключено из репозитория

- `Binaries/` - Скомпилированные файлы
- `DerivedDataCache/` - Кэш UE5
- `Intermediate/` - Промежуточные файлы сборки
- `Saved/` - Сохранения и логи
- IDE файлы: `.vs/`, `.idea/`, `.vscode/`
- Системные файлы: `Thumbs.db`, `.DS_Store`

## Лицензия

Проект разработан для образовательных целей. Лицензия/условия использования — TBD (добавьте `LICENSE`, когда определитесь).