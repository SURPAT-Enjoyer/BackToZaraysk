# üî¨ –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –ö–û–î–ê BACKTOZARAYSK

## üìä –ú–ï–¢–†–ò–ö–ò –°–õ–û–ñ–ù–û–°–¢–ò

### InventoryWidget.cpp - –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –§–ê–ô–õ
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: 2,638 —Å—Ç—Ä–æ–∫
- **–§—É–Ω–∫—Ü–∏–π**: ~80+ —Ñ—É–Ω–∫—Ü–∏–π
- **–¶–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å**: –û–ß–ï–ù–¨ –í–´–°–û–ö–ê–Ø
- **–í–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å**: –î–æ 6-7 —É—Ä–æ–≤–Ω–µ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏

**–ü—Ä–æ–±–ª–µ–º—ã:**
```cpp
// –ü—Ä–∏–º–µ—Ä –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –∏–∑ –∫–æ–¥–∞:
for (int32 i = 0; i < RootCanvas->GetChildrenCount(); ++i)
{
    if (UWidget* C = RootCanvas->GetChildAt(i))
    {
        if (C->GetFName() == TEXT("BackpackStorageCanvas"))
        {
            if (UCanvasPanel* BGrid = Cast<UCanvasPanel>(C))
            {
                TArray<UWidget*> BChildren = BGrid->GetAllChildren();
                for (UWidget* W : BChildren)
                {
                    if (UInventoryItemWidget* IW = Cast<UInventoryItemWidget>(W))
                    {
                        if (UCanvasPanelSlot* S = Cast<UCanvasPanelSlot>(IW->Slot))
                        {
                            // ... –µ—â–µ 3-4 —É—Ä–æ–≤–Ω—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
                        }
                    }
                }
            }
        }
    }
}
```

### –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **–í—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π**: 344 –≤—ã–∑–æ–≤–∞ `GEngine->AddOnScreenDebugMessage`
- **–ü–æ —Ñ–∞–π–ª–∞–º**:
  - `InventoryWidget.cpp`: 45 –≤—ã–∑–æ–≤–æ–≤
  - `InventoryComponent.cpp`: 49 –≤—ã–∑–æ–≤–æ–≤
  - `BTZPlayerController.cpp`: 24 –≤—ã–∑–æ–≤–∞
  - `EquipmentBase.cpp`: 18 –≤—ã–∑–æ–≤–æ–≤
  - –û—Å—Ç–∞–ª—å–Ω—ã–µ: 208 –≤—ã–∑–æ–≤–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å —É—Ä–æ–≤–Ω—è–º–∏ (Log, Warning, Error)

---

## üêõ –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ë–ê–ì–ò –ò –ü–†–û–ë–õ–ï–ú–´

### 1. –£–¢–ï–ß–ö–ò –ü–ê–ú–Ø–¢–ò

#### –ü—Ä–æ–±–ª–µ–º–∞: –í–∏–¥–∂–µ—Ç—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
```cpp
// InventoryWidget.cpp - DestroyVestGrid()
void UInventoryWidget::DestroyVestGrid()
{
    for (UCanvasPanel* Grid : VestGrids)
    {
        if (Grid)
        {
            // –ü–†–û–ë–õ–ï–ú–ê: –î–µ—Ç–∏ –≤–∏–¥–∂–µ—Ç–∞ –º–æ–≥—É—Ç –Ω–µ —É–¥–∞–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            TArray<UWidget*> Children = Grid->GetAllChildren();
            for (UWidget* Child : Children)
            {
                if (UInventoryItemWidget* IW = Cast<UInventoryItemWidget>(Child))
                {
                    // –ù—É–∂–Ω–æ —è–≤–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤–∏–¥–∂–µ—Ç
                    IW->RemoveFromParent();
                }
            }
        }
    }
    VestGrids.Empty();
}
```

#### –ü—Ä–æ–±–ª–µ–º–∞: TMap –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏
```cpp
// InventoryComponent.cpp
TMap<TObjectPtr<UEquippableItemData>, TArray<TObjectPtr<UInventoryItemData>>> EquipmentStorage;
// –ï—Å–ª–∏ ItemData —É–¥–∞–ª—è–µ—Ç—Å—è, —É–∫–∞–∑–∞—Ç–µ–ª—å –≤ TMap —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º
```

### 2. –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

#### –ü—Ä–æ–±–ª–µ–º–∞: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø–æ –º–∞—Å—Å–∏–≤–∞–º
```cpp
// InventoryWidget.cpp - UpdateVestGrid()
// –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
for (UInventoryItemData* Data : VestItems)  // –ò—Ç–µ—Ä–∞—Ü–∏—è 1
{
    for (int32 GridIndex = 0; GridIndex < 6; ++GridIndex)  // –ò—Ç–µ—Ä–∞—Ü–∏—è 2
    {
        for (int32 r = 0; r < 2; ++r)  // –ò—Ç–µ—Ä–∞—Ü–∏—è 3
        {
            for (int32 c = 0; c < 6; ++c)  // –ò—Ç–µ—Ä–∞—Ü–∏—è 4
            {
                // O(n * 6 * 2 * 6) = O(72n) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞!
            }
        }
    }
}
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–∏—Å–∫ –≤ TArray –≤–º–µ—Å—Ç–æ TMap
```cpp
// InventoryComponent.cpp - RemoveSpecificFromBackpack()
const int32 Index = BackpackItems.Find(Item);  // O(n) –ø–æ–∏—Å–∫
// –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TMap<Item*, Index> –¥–ª—è O(1) –ø–æ–∏—Å–∫–∞
```

### 3. –†–ê–°–•–û–ñ–î–ï–ù–ò–ï –î–ê–ù–ù–´–•

#### –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
```cpp
// EquippableItemData.h
TMap<UInventoryItemData*, FIntPoint> StoredCellByItem;      // Runtime
TMap<UInventoryItemData*, FIntPoint> PersistentCellByItem;  // Persistent
TMap<UInventoryItemData*, bool> StoredRotByItem;            // Runtime
TMap<UInventoryItemData*, bool> PersistentRotByItem;      // Persistent

// –ü–†–û–ë–õ–ï–ú–ê: –î–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã - –º–æ–≥—É—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É EquipmentStorage –∏ PersistentStorage
```cpp
// InventoryComponent.cpp - AddToEquipmentStorage()
TArray<TObjectPtr<UInventoryItemData>>& StorageItems = EquipmentStorage.FindOrAdd(Equipment);
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å PersistentStorage —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—É—Å—Ç–æ–º StorageItems
if (StorageItems.Num() == 0 && Equipment->PersistentStorage.Num() > 0)
{
    StorageItems = Equipment->PersistentStorage;  // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –º–∞—Å—Å–∏–≤–∞
}
```

### 4. –û–®–ò–ë–ö–ò –û–ë–†–ê–ë–û–¢–ö–ò

#### –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞ nullptr
```cpp
// InventoryWidget.cpp - –º–Ω–æ–∂–µ—Å—Ç–≤–æ –º–µ—Å—Ç
UInventoryItemWidget* IW = Cast<UInventoryItemWidget>(W);
if (IW)  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –µ—Å—Ç—å
{
    if (UCanvasPanelSlot* S = Cast<UCanvasPanelSlot>(IW->Slot))  // Slot –º–æ–∂–µ—Ç –±—ã—Ç—å nullptr!
    {
        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ S –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
    }
}
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤
```cpp
// –ú–Ω–æ–∂–µ—Å—Ç–≤–æ Cast<> –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
UEquippableItemData* EqData = Cast<UEquippableItemData>(ItemInstance);
// –°—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è EqData –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ nullptr
```

---

## üîÑ –¶–ò–ö–õ–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –°–õ–û–ñ–ù–û–°–¢–¨

### –¢–æ–ø-5 —Å–∞–º—ã—Ö —Å–ª–æ–∂–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

#### 1. `NativeOnDrop()` - –°–ª–æ–∂–Ω–æ—Å—Ç—å: ~25
```cpp
// –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ if-—ã, –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤, —Ü–∏–∫–ª—ã
// ~200 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
// –û—Ü–µ–Ω–∫–∞: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø
```

#### 2. `UpdateVestGrid()` - –°–ª–æ–∂–Ω–æ—Å—Ç—å: ~20
```cpp
// –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã –ø–æ –≥—Ä–∏–¥–∞–º –∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º
// ~150 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
// –û—Ü–µ–Ω–∫–∞: –í–´–°–û–ö–ê–Ø
```

#### 3. `TryPickupItem()` - –°–ª–æ–∂–Ω–æ—Å—Ç—å: ~18
```cpp
// –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏–π, —Ü–∏–∫–ª—ã –ø–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º
// ~100 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
// –û—Ü–µ–Ω–∫–∞: –í–´–°–û–ö–ê–Ø
```

#### 4. `IsAreaFreeInEquipment()` - –°–ª–æ–∂–Ω–æ—Å—Ç—å: ~15
```cpp
// –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏
// ~80 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
// –û—Ü–µ–Ω–∫–∞: –°–†–ï–î–ù–Ø–Ø
```

#### 5. `SetVisible()` - –°–ª–æ–∂–Ω–æ—Å—Ç—å: ~12
```cpp
// –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Ü–∏–∫–ª—ã
// ~100 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
// –û—Ü–µ–Ω–∫–∞: –°–†–ï–î–ù–Ø–Ø
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –†–∞–∑–±–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–Ω–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç—ã

---

## üìà –ê–ù–ê–õ–ò–ó –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

### –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π

| –û–ø–µ—Ä–∞—Ü–∏—è | –¢–µ–∫—É—â–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å | –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------|-------------------|-------------|-----------|
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Ä—é–∫–∑–∞–∫ | O(1) | O(1) | ‚úÖ |
| –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ —Ä—é–∫–∑–∞–∫–∞ | O(n) | O(1) | ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TMap |
| –ü–æ–∏—Å–∫ –ø—Ä–µ–¥–º–µ—Ç–∞ | O(n) | O(1) | ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TMap |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ –≥—Ä–∏–¥–∞ | O(n¬≤) | O(1) | ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏—Ç–æ–≤—É—é –º–∞—Å–∫—É |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∂–∏–ª–µ—Ç–∞ | O(n * m) | O(n) | ‚ö†Ô∏è –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç—ã |
| Drag-and-Drop | O(n) | O(log n) | ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å |

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞:**
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: StoredCellByItem + PersistentCellByItem
2. **–í–∏–¥–∂–µ—Ç—ã –Ω–µ –ø—É–ª—è—Ç—Å—è**: –°—Ç–∞—Ä—ã–µ –≤–∏–¥–∂–µ—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
3. **TArray –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è**: –ü—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è —Ü–µ–ª—ã–µ –º–∞—Å—Å–∏–≤—ã

**–û—Ü–µ–Ω–∫–∞ –ø–∞–º—è—Ç–∏ –Ω–∞ 100 –ø—Ä–µ–¥–º–µ—Ç–æ–≤:**
- –¢–µ–∫—É—â–∞—è: ~2.5 MB
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è: ~1.2 MB
- –≠–∫–æ–Ω–æ–º–∏—è: 52%

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. –ù–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility Principle

**InventoryWidget** –¥–µ–ª–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UI
- –û–±—Ä–∞–±–æ—Ç–∫–∞ Drag-and-Drop
- –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã/–º—ã—à–∏

**–†–µ—à–µ–Ω–∏–µ**: –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞:
- `UInventoryWidget` - –ë–∞–∑–æ–≤—ã–π UI
- `UInventoryGridManager` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∏–¥–∞–º–∏
- `UInventoryDragDropHandler` - –û–±—Ä–∞–±–æ—Ç–∫–∞ DnD
- `UInventoryPlacementSystem` - –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è

### 2. –¢–µ—Å–Ω–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å

```cpp
// InventoryWidget –Ω–∞–ø—Ä—è–º—É—é –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:
- InventoryComponent
- EquippableItemData
- InventoryItemData
- EquipmentComponent
- PlayerCharacter
```

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Interfaces –∏ Events

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π

```cpp
// –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –≤–º–µ—Å—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
PlayerChar->InventoryComponent->AddToBackpack(Item);
// –õ—É—á—à–µ:
InventoryService->AddItem(Item, EStorageType::Backpack);
```

---

## üîç –ê–ù–ê–õ–ò–ó –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô

### –ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```
InventoryWidget
‚îú‚îÄ InventoryComponent (—Å–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å)
‚îú‚îÄ EquippableItemData (—Å–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å)
‚îú‚îÄ InventoryItemData (—Å–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å)
‚îú‚îÄ EquipmentComponent (—Å–ª–∞–±–∞—è —Å–≤—è–∑—å)
‚îî‚îÄ PlayerCharacter (—Å–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å)

InventoryComponent
‚îú‚îÄ EquippableItemData (—Å–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å)
‚îú‚îÄ EquipmentComponent (—Å–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å)
‚îî‚îÄ PlayerCharacter (—Å–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å)

EquipmentComponent
‚îî‚îÄ EquippableItemData (—Å–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å)
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏–ª—å–Ω–æ —Å–≤—è–∑–∞–Ω—ã, —Å–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ

---

## üß™ –¢–ï–°–¢–ò–†–£–ï–ú–û–°–¢–¨

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

1. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç UMG**: –í–∏–¥–∂–µ—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∏–≥—Ä–æ–≤–æ–≥–æ –º–∏—Ä–∞
2. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç PlayerCharacter**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
3. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã**: `GEngine->AddOnScreenDebugMessage` –Ω–µ –º–æ–∫–∞—é—Ç—Å—è
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Interfaces**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∏–∑ –≤–∏–¥–∂–µ—Ç–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Dependency Injection
3. –°–æ–∑–¥–∞—Ç—å Interfaces –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Events –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤

---

## üìù –ö–ê–ß–ï–°–¢–í–û –ö–û–î–ê

### Code Smells

1. **Long Method**: `NativeOnDrop()` - 200+ —Å—Ç—Ä–æ–∫
2. **Large Class**: `InventoryWidget` - 2600+ —Å—Ç—Ä–æ–∫
3. **Duplicate Code**: –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è
4. **Magic Numbers**: `60.f`, `70.f`, `300.f` - —Ä–∞–∑–º–µ—Ä—ã —è—á–µ–µ–∫
5. **Deep Nesting**: –î–æ 7 —É—Ä–æ–≤–Ω–µ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
6. **Feature Envy**: –í–∏–¥–∂–µ—Ç –∑–Ω–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–æ—Ä–º–∞ | –°—Ç–∞—Ç—É—Å |
|---------|----------|-------|--------|
| –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏ | 45 —Å—Ç—Ä–æ–∫ | <30 | ‚ö†Ô∏è |
| –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å | 7 —É—Ä–æ–≤–Ω–µ–π | <4 | ‚ùå |
| –¶–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å | 25 (max) | <10 | ‚ùå |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ | ~15% | <5% | ‚ö†Ô∏è |
| –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ | ~10% | >30% | ‚ùå |

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∞—à –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤

```cpp
// InventoryWidget.cpp
void UInventoryWidget::UpdateVestGrid()
{
    // –ï—Å–ª–∏ ItemData —É–¥–∞–ª—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI - –∫—Ä–∞—à
    for (UInventoryItemData* Data : VestItems)
    {
        if (!Data || !IsValid(Data)) continue;  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –µ—Å—Ç—å, –Ω–æ –Ω–µ –≤–µ–∑–¥–µ
        // ...
    }
}
```

### 2. Race Condition –ø—Ä–∏ Drag-and-Drop

```cpp
// –ï—Å–ª–∏ –¥–≤–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
// –ú–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏
```

### 3. –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è

```cpp
// –í–∏–¥–∂–µ—Ç—ã –Ω–µ –≤—Å–µ–≥–¥–∞ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
// –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏
```

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö–†–ò–¢–ò–ß–ù–û

1. **–†–∞–∑–±–∏—Ç—å InventoryWidget**
   - –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≥—Ä–∏–¥–æ–≤ –≤ `UInventoryGridManager`
   - –í—ã–Ω–µ—Å—Ç–∏ DnD –≤ `UInventoryDragDropHandler`
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ UI –ª–æ–≥–∏–∫—É

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏**
   - –Ø–≤–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ WeakPtr –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫**
   - –ó–∞–º–µ–Ω–∏—Ç—å TArray –Ω–∞ TMap –¥–ª—è O(1) –ø–æ–∏—Å–∫–∞
   - –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç—ã
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏—Ç–æ–≤—ã–µ –º–∞—Å–∫–∏ –¥–ª—è –∑–∞–Ω—è—Ç–æ—Å—Ç–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–ê–ñ–ù–û

4. **–£–ª—É—á—à–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**
   - –°–æ–∑–¥–∞—Ç—å Interfaces
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Events
   - Dependency Injection

5. **–£–ª—É—á—à–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**
   - –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∏–∑ –≤–∏–¥–∂–µ—Ç–æ–≤
   - –°–æ–∑–¥–∞—Ç—å –º–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
   - –ù–∞–ø–∏—Å–∞—Ç—å Unit —Ç–µ—Å—Ç—ã

6. **–£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–∏–∫–ª—ã
   - –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
   - Lazy loading –≤–∏–¥–∂–µ—Ç–æ–≤

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û

7. **–£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**
   - –£–º–µ–Ω—å—à–∏—Ç—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å
   - –†–∞–∑–±–∏—Ç—å –¥–ª–∏–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
   - –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

8. **–£–ª—É—á—à–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**
   - –ó–∞–º–µ–Ω–∏—Ç—å GEngine –Ω–∞ UE_LOG
   - –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞: **6.5/10**

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

**–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚ùå –í—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞
- ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- ‚ùå –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
- ‚ùå –°–ª–∞–±–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:**
1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ InventoryWidget (–∫—Ä–∏—Ç–∏—á–Ω–æ)
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–≤–∞–∂–Ω–æ)
3. –£–ª—É—á—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)

---

## üìÖ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –ù–µ–¥–µ–ª—è 1-2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- [ ] –†–∞–∑–±–∏—Ç—å InventoryWidget –Ω–∞ –º–æ–¥—É–ª–∏
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≥—Ä–∏–¥–æ–≤
- [ ] –í—ã–Ω–µ—Å—Ç–∏ DnD –æ–±—Ä–∞–±–æ—Ç–∫—É

### –ù–µ–¥–µ–ª—è 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å TArray –Ω–∞ TMap
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–∏–∫–ª—ã
- [ ] –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç—ã

### –ù–µ–¥–µ–ª—è 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å Unit —Ç–µ—Å—Ç—ã
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –±–∞–≥–∏
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 2024
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: UE5.3
**–ê–Ω–∞–ª–∏—Ç–∏–∫**: AI Code Assistant


